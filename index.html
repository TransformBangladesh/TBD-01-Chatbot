<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TBD-01 AI Chat</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap');
        @import url('https://fonts.googleapis.com/css2?family=Google+Sans:wght@400;500;700&display=swap'); /* Often used in Google products */

        :root {
            --app-bg: #131314; /* Main dark background */
            --surface-bg: #1e1f20; /* Slightly lighter surface for elements */
            --text-primary: #e8eaed; /* Primary light text */
            --text-secondary: #9aa0a6; /* Secondary, dimmer text */
            --accent-blue: #89b4f8; /* Accent blue for interactions */
            --button-bg: #303134; /* Default button background */
            --button-hover-bg: #3c4043;
            --input-bg: #202124; /* Input field background */
            --border-color: #3c4043; /* Borders */
            --border-radius-main: 12px;
            --border-radius-buttons: 24px; /* Pill shape */

            /* Suggestion button icon colors */
            --icon-green: #34a853;
            --icon-orange: #fbbc04;
            --icon-yellow: #fadd63; /* Lighter yellow for lightbulb */
            --icon-blue: #4285f4;

            --user-message-bg: #3c4043; /* Darker bubble for user */
            --ai-message-bg: #282a2c;   /* Slightly lighter for AI */
            --copy-button-bg: #4a4d50;
            --copy-button-hover-bg: #5f6368;
        }

        body {
            font-family: 'Google Sans', 'Roboto', sans-serif;
            margin: 0;
            background-color: var(--app-bg);
            color: var(--text-primary);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-end; /* Align content to bottom for mobile feel */
            min-height: 100vh;
            padding: 0;
            box-sizing: border-box;
            overflow: hidden; /* Prevent body scroll, chat box will scroll */
        }

        #app-container {
            width: 100%;
            max-width: 480px; /* Typical mobile screen width for the design */
            height: 100vh; /* Full height */
            background-color: var(--app-bg);
            display: flex;
            flex-direction: column;
            box-shadow: 0 0 20px rgba(0,0,0,0.5); /* Subtle shadow if needed on larger screens */
        }

        #app-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 16px;
            background-color: var(--app-bg); /* Match body or surface */
            border-bottom: 1px solid var(--border-color);
        }

        .header-icon, .get-plus-btn {
            background: none;
            border: none;
            color: var(--text-secondary);
            padding: 8px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: background-color 0.2s;
        }
        .header-icon:hover, .get-plus-btn:hover {
            background-color: var(--button-bg);
        }
        .header-icon svg {
            width: 24px;
            height: 24px;
            fill: currentColor;
        }
        .get-plus-btn {
            background-color: var(--button-bg);
            color: var(--text-primary);
            padding: 8px 16px;
            border-radius: var(--border-radius-buttons);
            font-size: 0.9em;
            font-weight: 500;
        }
        .get-plus-btn .sparkle {
            width: 16px;
            height: 16px;
            margin-left: 6px;
            fill: var(--icon-yellow);
        }


        #suggestions-area {
            padding: 24px 16px 16px 16px;
            text-align: center;
        }
        #suggestions-area h2 {
            font-size: 1.8em;
            font-weight: 500;
            color: var(--text-primary);
            margin-bottom: 20px;
        }
        .suggestion-buttons-grid {
            display: grid;
            grid-template-columns: 1fr 1fr; /* Two columns */
            gap: 12px;
            margin-bottom: 12px;
        }

        .suggestion-btn {
            background-color: var(--surface-bg);
            color: var(--text-primary);
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius-main);
            padding: 12px;
            font-size: 0.9em;
            cursor: pointer;
            text-align: left;
            display: flex;
            align-items: center;
            transition: background-color 0.2s;
            width: 100%;
        }
        .suggestion-btn:hover {
            background-color: var(--button-hover-bg);
        }
        .suggestion-btn .btn-icon {
            margin-right: 10px;
            font-size: 1.5em; /* For emoji/unicode icons */
            width: 24px; height: 24px; /* For SVG icons */
            display: inline-flex;
            align-items: center;
            justify-content: center;
        }
        .suggestion-btn .btn-icon svg {
             width: 20px; height: 20px;
        }
        .more-suggestions-btn {
            background-color: var(--button-bg);
            color: var(--text-secondary);
            border: none;
        }

        #chat-view {
            flex-grow: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden; /* Important for nested scrolling */
        }

        #chat-box {
            flex-grow: 1;
            padding: 16px;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 12px; /* Gap between messages */
        }
        /* Custom scrollbar for dark theme */
        #chat-box::-webkit-scrollbar { width: 6px; }
        #chat-box::-webkit-scrollbar-track { background: var(--surface-bg); }
        #chat-box::-webkit-scrollbar-thumb { background: #5f6368; border-radius: 3px;}
        #chat-box::-webkit-scrollbar-thumb:hover { background: #7f8388; }


        .message {
            padding: 10px 14px;
            border-radius: 18px; /* More rounded like the image */
            max-width: 80%;
            line-height: 1.5;
            word-wrap: break-word;
            animation: fadeIn 0.4s ease-out;
            position: relative;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(8px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .user-message {
            background-color: var(--user-message-bg);
            color: var(--text-primary);
            align-self: flex-end;
            border-bottom-right-radius: 6px;
        }

        .ai-message {
            background-color: var(--ai-message-bg);
            color: var(--text-primary);
            align-self: flex-start;
            border-bottom-left-radius: 6px;
            padding-bottom: 30px; /* Space for copy button */
        }
        .message-sender {
            font-weight: 500;
            margin-bottom: 5px;
            font-size: 0.8em;
            color: var(--text-secondary);
        }
        .message-content {
            font-size: 0.95em;
        }

        .copy-button {
            position: absolute;
            bottom: 6px;
            right: 8px;
            background-color: var(--copy-button-bg);
            color: var(--text-primary);
            border: none;
            border-radius: 4px;
            padding: 4px 8px;
            font-size: 0.7em;
            cursor: pointer;
            opacity: 0;
            transition: opacity 0.2s ease-in-out, background-color 0.2s ease;
        }
        .ai-message:hover .copy-button { opacity: 1; }
        .copy-button:hover { background-color: var(--copy-button-hover-bg); }
        .copy-button.copied { background-color: var(--accent-blue); color: var(--app-bg); }


        #input-area-wrapper { /* Wrapper to pin to bottom */
            padding: 8px 12px 16px 12px; /* Padding around input bar, more at bottom for home bar */
            background-color: var(--app-bg);
            border-top: 1px solid var(--border-color);
        }
        #input-area {
            display: flex;
            align-items: center;
            background-color: var(--input-bg);
            border-radius: var(--border-radius-buttons);
            padding: 4px; /* Inner padding for the input bar */
        }
        /* Placeholder for left icons in input bar, can be implemented later */
        .input-action-icon {
            padding: 8px;
            margin: 0 4px;
            color: var(--text-secondary);
            cursor: pointer;
        }
        .input-action-icon svg { width: 20px; height: 20px; fill: currentColor; }

        #user-input {
            flex-grow: 1;
            padding: 10px 12px;
            background-color: transparent;
            border: none;
            color: var(--text-primary);
            font-size: 1em;
            outline: none;
        }
        #user-input::placeholder {
            color: var(--text-secondary);
        }

        #send-button {
            background-color: var(--accent-blue); /* Prominent send button */
            color: var(--app-bg); /* Dark text on light blue */
            border: none;
            border-radius: 50%; /* Circular */
            width: 40px;
            height: 40px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: background-color 0.2s;
            margin-left: 6px; /* Space from input */
        }
        #send-button svg {
            width: 20px;
            height: 20px;
            fill: currentColor;
        }
        #send-button:hover {
            background-color: #a5c8f6; /* Lighter blue on hover */
        }
        #send-button:disabled {
            background-color: var(--button-bg);
            cursor: not-allowed;
        }
        #send-button:disabled svg {
             fill: var(--text-secondary);
        }

        .loading-indicator {
            display: flex;
            align-items: center;
            justify-content: flex-start; /* Align to start for AI message */
            padding: 0; /* Handled by message bubble */
            animation: fadeIn 0.3s ease-out;
        }
        .dot-flashing {
            position: relative; width: 6px; height: 6px; border-radius: 5px;
            background-color: var(--accent-blue); color: var(--accent-blue);
            animation: dotFlashing 1s infinite linear alternate; animation-delay: .5s;
            margin: 0 3px;
        }
        .dot-flashing::before, .dot-flashing::after {
            content: ''; display: inline-block; position: absolute; top: 0;
        }
        .dot-flashing::before {
            left: -10px; width: 6px; height: 6px; border-radius: 5px;
            background-color: var(--accent-blue); color: var(--accent-blue);
            animation: dotFlashing 1s infinite alternate; animation-delay: 0s;
        }
        .dot-flashing::after {
            left: 10px; width: 6px; height: 6px; border-radius: 5px;
            background-color: var(--accent-blue); color: var(--accent-blue);
            animation: dotFlashing 1s infinite alternate; animation-delay: 1s;
        }
        @keyframes dotFlashing {
            0% { background-color: var(--accent-blue); }
            50%, 100% { background-color: rgba(137, 180, 248, 0.4); }
        }

        /* Hide suggestion area when chat has messages to mimic transition */
        #app-container.chat-active #suggestions-area {
            display: none;
        }
    </style>
</head>
<body>
    <div id="app-container">
        <div id="app-header">
            <button class="header-icon" id="menu-btn" aria-label="Menu">
                <svg viewBox="0 0 24 24"><path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"></path></svg>
            </button>
            <button class="get-plus-btn" id="get-plus-btn">
                Get Plus
                <svg class="sparkle" viewBox="0 0 24 24"><path d="M12 2l2.36 7.19H22l-6.06 4.38 2.32 7.24L12 16.42l-6.26 4.39 2.32-7.24L2 9.19h7.64L12 2z"></path></svg>
            </button>
            <button class="header-icon" id="history-btn" aria-label="History">
                <svg viewBox="0 0 24 24"><path d="M13 3a9 9 0 0 0-9 9H1l3.89 3.89.07.14L9 12H6c0-3.87 3.13-7 7-7s7 3.13 7 7-3.13 7-7 7c-1.93 0-3.68-.79-4.94-2.06l-1.42 1.42A8.954 8.954 0 0 0 13 21a9 9 0 0 0 0-18zm-1 5v5l4.25 2.52.77-1.28-3.52-2.09V8H12z"></path></svg>
            </button>
        </div>

        <div id="suggestions-area">
            <h2>What can I help with?</h2>
            <div class="suggestion-buttons-grid">
                <button class="suggestion-btn" data-prompt="Create an image of a futuristic city at sunset">
                    <span class="btn-icon" style="color: var(--icon-green);">
                        <svg viewBox="0 0 24 24"><path fill="currentColor" d="M21.586 2.414a2.004 2.004 0 0 0-2.828 0L3 18.252V21h2.748l15.838-15.838a2 2 0 0 0 0-2.748zM8.687 19H5V15.313l8.5-8.5L17.187 10.5l-8.5 8.5zM18 9.086L14.914 6L16.5 4.414L19.586 7.5L18 9.086z"/></svg>
                    </span> Create image
                </button>
                <button class="suggestion-btn" data-prompt="Summarize this text for me: [paste text here]">
                     <span class="btn-icon" style="color: var(--icon-orange);">
                        <svg viewBox="0 0 24 24"><path fill="currentColor" d="M14 2H6c-1.1 0-1.99.9-1.99 2L4 20c0 1.1.89 2 1.99 2H18c1.1 0 2-.9 2-2V8l-6-6zm2 16H8v-2h8v2zm0-4H8v-2h8v2zm-3-5V3.5L18.5 9H13z"/></svg>
                    </span> Summarize text
                </button>
                <button class="suggestion-btn" data-prompt="Make a plan for a healthy week of meals">
                    <span class="btn-icon" style="color: var(--icon-yellow);">
                        <svg viewBox="0 0 24 24"><path fill="currentColor" d="M9 21c0 .55.45 1 1 1h4c.55 0 1-.45 1-1V9H9v12zm3-15c-2.66 0-5.19 1.28-6.74 3.44L6.9 8.3A7.015 7.015 0 0 1 12 4c2.42 0 4.6.95 6.24 2.56l1.42-1.42C17.53 3.05 14.9 2 12 2C6.48 2 2 6.48 2 12s4.48 10 10 10c.55 0 1-.45 1-1v-1c0-.55-.45-1-1-1h-1c-.55 0-1 .45-1 1v1h-1c0 .55-.45 1-1 1s-1-.45-1-1v-2c0-.55-.45-1-1-1h-1c-.55 0-1 .45-1 1v2H9V9c0-.55-.45-1-1-1H7c-.55 0-1 .45-1 1v2c0 1.61.79 3.04 2 3.87V21H9zM12 7c1.1 0 2-.9 2-2s-.9-2-2-2s-2 .9-2 2s.9 2 2 2z"/></svg>
                    </span> Make a plan
                </button>
                <button class="suggestion-btn" data-prompt="Get advice on how to start a new hobby">
                    <span class="btn-icon" style="color: var(--icon-blue);">
                         <svg viewBox="0 0 24 24"><path fill="currentColor" d="M12 3L1 9l11 6 9-4.91V17h2V9L12 3zm0 7.69L6.46 7.5L12 4.31L17.54 7.5L12 10.69zM3.76 10.73l8.24 4.51V21H3.76c-.98 0-1.76-.78-1.76-1.76V10.73zm16.48 0v8.51c0 .98-.78 1.76-1.76 1.76h-6.48V15.24l8.24-4.51z"/></svg>
                    </span> Get advice
                </button>
            </div>
            <button class="suggestion-btn more-suggestions-btn" id="more-suggestions">More</button>
        </div>

        <div id="chat-view">
            <div id="chat-box">
                <!-- Messages will appear here -->
            </div>
        </div>

        <div id="input-area-wrapper">
            <div id="input-area">
                <!-- Placeholder for left icons like gallery/tune, not functional in this example -->
                <!-- <button class="input-action-icon"><svg>...</svg></button> -->
                <input type="text" id="user-input" placeholder="Ask anything..." aria-label="User message input">
                <button id="send-button" aria-label="Send message">
                    <svg viewBox="0 0 24 24"><path d="M2.01 21L23 12 2.01 3 2 10l15 2-15 2z"></path></svg>
                </button>
            </div>
        </div>
    </div>

    <script type="module">
        // WARNING: API KEY IS EMBEDDED IN CLIENT-SIDE CODE. HIGHLY INSECURE FOR PRODUCTION.
        const API_KEY = "AIzaSyCtny6zNAmdo_WifF21QJS4KpfGSzuDT1I"; // Your API Key
        const MODEL_NAME = "gemini-2.0-flash"; // As requested [1, 7]

        const appContainer = document.getElementById('app-container');
        const chatBox = document.getElementById('chat-box');
        const userInput = document.getElementById('user-input');
        const sendButton = document.getElementById('send-button');
        const suggestionsArea = document.getElementById('suggestions-area');

        const menuBtn = document.getElementById('menu-btn');
        const getPlusBtn = document.getElementById('get-plus-btn');
        const historyBtn = document.getElementById('history-btn');
        const moreSuggestionsBtn = document.getElementById('more-suggestions');


        let chatHistory = [];
        let messagesExist = false;

        function updateChatView() {
            if (messagesExist) {
                appContainer.classList.add('chat-active');
            } else {
                appContainer.classList.remove('chat-active');
            }
             chatBox.scrollTop = chatBox.scrollHeight;
        }


        function addMessage(sender, text, isUser) {
            messagesExist = true;
            updateChatView();

            const messageDiv = document.createElement('div');
            messageDiv.classList.add('message', isUser ? 'user-message' : 'ai-message');

            const senderDiv = document.createElement('div');
            senderDiv.classList.add('message-sender');
            senderDiv.textContent = sender;
            // No sender name for user messages for a cleaner look like the image
            if (!isUser) {
                 messageDiv.appendChild(senderDiv);
            }


            const textContentDiv = document.createElement('div');
            textContentDiv.classList.add('message-content');
            let processedText = text.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>');
            processedText = processedText.replace(/\*(.*?)\*/g, '<em>$1</em>');
            processedText = processedText.replace(/\n/g, '<br>');
            textContentDiv.innerHTML = processedText;
            messageDiv.appendChild(textContentDiv);

            if (!isUser) {
                senderDiv.textContent = "TBD-01"; // AI name
                const copyButton = document.createElement('button');
                copyButton.classList.add('copy-button');
                copyButton.textContent = 'Copy';
                copyButton.setAttribute('aria-label', 'Copy message');
                copyButton.onclick = function() {
                    navigator.clipboard.writeText(text)
                        .then(() => {
                            copyButton.textContent = 'Copied!';
                            copyButton.classList.add('copied');
                            setTimeout(() => {
                                copyButton.textContent = 'Copy';
                                copyButton.classList.remove('copied');
                            }, 1500);
                        })
                        .catch(err => {
                            console.error('Failed to copy: ', err);
                            copyButton.textContent = 'Error';
                             setTimeout(() => { copyButton.textContent = 'Copy';}, 1500);
                        });
                };
                messageDiv.appendChild(copyButton);
            }

            chatBox.appendChild(messageDiv);
            chatBox.scrollTop = chatBox.scrollHeight;
        }

        function showLoading() {
            sendButton.disabled = true;
            userInput.disabled = true; // Disable input while loading

            // If suggestions are visible, hide them for loading indicator
            if (!appContainer.classList.contains('chat-active')) {
                 messagesExist = true; // Treat loading as a message start
                 updateChatView();
            }

            const loadingContainerId = 'ai-thinking-indicator';
            if (document.getElementById(loadingContainerId)) return; // Avoid multiple loaders

            const loadingContainer = document.createElement('div');
            loadingContainer.id = loadingContainerId;
            loadingContainer.classList.add('message', 'ai-message', 'loading-indicator'); // Style like AI message

            const senderDiv = document.createElement('div');
            senderDiv.classList.add('message-sender');
            senderDiv.textContent = "TBD-01";
            loadingContainer.appendChild(senderDiv);

            const dotsDiv = document.createElement('div');
            dotsDiv.classList.add('dot-flashing');
            loadingContainer.appendChild(dotsDiv);

            chatBox.appendChild(loadingContainer);
            chatBox.scrollTop = chatBox.scrollHeight;
        }

        function hideLoading() {
            sendButton.disabled = false;
            userInput.disabled = false; // Re-enable input
            userInput.focus();
            const loadingDiv = document.getElementById('ai-thinking-indicator');
            if (loadingDiv) {
                chatBox.removeChild(loadingDiv);
            }
        }

        async function sendMessageToAI(messageText) {
            if (!messageText.trim()) return;

            addMessage("You", messageText, true);
            userInput.value = '';
            showLoading();

            chatHistory.push({ role: "user", parts: [{ text: messageText }] });

            const apiEndpoint = `https://generativelanguage.googleapis.com/v1beta/models/${MODEL_NAME}:generateContent?key=${API_KEY}`;

            try {
                const response = await fetch(apiEndpoint, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        contents: chatHistory,
                        // generationConfig: { temperature: 0.7 } // Optional
                    }),
                });

                hideLoading();

                if (!response.ok) {
                    const errorData = await response.json();
                    let errMsg = `API Error: ${response.status}`;
                    if (errorData.error && errorData.error.message) errMsg += ` - ${errorData.error.message}`;
                    throw new Error(errMsg);
                }

                const data = await response.json();

                if (data.candidates && data.candidates[0].content && data.candidates[0].content.parts) {
                    const aiResponse = data.candidates[0].content.parts[0].text;
                    addMessage("TBD-01", aiResponse, false);
                    chatHistory.push({ role: "model", parts: [{ text: aiResponse }] });
                } else if (data.promptFeedback && data.promptFeedback.blockReason) {
                    const blockMsg = `Response blocked: ${data.promptFeedback.blockReason}. Try rephrasing.`;
                    addMessage("TBD-01", blockMsg, false);
                } else {
                    addMessage("TBD-01", "Sorry, I couldn't get a response. Please check the console.", false);
                }

            } catch (error) {
                hideLoading();
                console.error('Error calling Gemini API:', error);
                addMessage("TBD-01", `Error: ${error.message}`, false);
            }
        }

        sendButton.addEventListener('click', () => sendMessageToAI(userInput.value));
        userInput.addEventListener('keypress', (event) => {
            if (event.key === 'Enter') {
                event.preventDefault();
                sendMessageToAI(userInput.value);
            }
        });

        // Suggestion buttons functionality
        document.querySelectorAll('.suggestion-btn').forEach(button => {
            if (button.id === 'more-suggestions') return; // Skip 'More' button for now
            button.addEventListener('click', () => {
                const prompt = button.dataset.prompt;
                userInput.value = prompt;
                // Optionally, send the message directly or just populate the input
                sendMessageToAI(prompt); // Send directly for quick interaction
                userInput.focus();
            });
        });

        // Placeholder actions for header buttons
        menuBtn.addEventListener('click', () => alert('Menu button clicked! (Not implemented)'));
        getPlusBtn.addEventListener('click', () => alert('Get Plus clicked! (Not implemented)'));
        historyBtn.addEventListener('click', () => alert('History button clicked! (Not implemented)'));
        moreSuggestionsBtn.addEventListener('click', () => alert('"More" suggestions clicked! (Not implemented)'));


        // Initial state: show suggestions, hide chat messages if none exist
        updateChatView();
        userInput.focus();

        // Optional: A gentle greeting from the AI if no messages exist, but hidden if suggestions are primary
        // if (!messagesExist) {
        //    addMessage("TBD-01", "Hello! What can I help you with today?", false);
        // }

    </script>
</body>
</html>